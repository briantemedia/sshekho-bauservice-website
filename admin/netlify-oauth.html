<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Decap CMS OAuth Redirect</title>
  <script>
    (function() {
      const fragment = (document.location.hash || '').replace(/^#/, '');
      const search = (document.location.search || '').replace(/^\?/, '');

      if (fragment) {
        // Teil 1: Verarbeitung der Antwort von GitHub (war bereits korrekt)
        if (window.opener) {
          window.opener.postMessage('authorization:github:success:' + JSON.stringify({
            token: fragment.split('=')[1].split('&')[0],
            provider: 'github'
          }), document.location.origin);
        }
      } else if (search) {
        // Teil 2: Weiterleitung zu GitHub (JETZT KORRIGIERT)
        const params = new URLSearchParams(search);
        // Entfernt den ung√ºltigen 'provider'-Parameter, der den 404-Fehler verursacht.
        params.delete('provider');
        
        const newSearch = params.toString();
        document.location.assign(
          'https://github.com/login/oauth/authorize?' + newSearch
        );
      } else {
        // Teil 3: Initialer Start des Popups (war bereits korrekt)
        if (window.opener) {
          window.opener.postMessage('authorizing:github', document.location.origin);
        }
      }
    })();
  </script>
</head>
<body>
</body>
</html>