<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Decap CMS OAuth Redirect</title>
  <script>
    (function() {
      const fragment = (document.location.hash || '').replace(/^#/, '');
      const search = (document.location.search || '').replace(/^\?/, '');

      if (fragment) {
        if (window.opener) {
          window.opener.postMessage('authorization:github:success:' + JSON.stringify({
            token: fragment.split('=')[1].split('&')[0],
            provider: 'github'
          }), document.location.origin);
        }
      } else if (search) {
        document.location.assign(
          'https://github.com/login/oauth/authorize?' + search
        );
      } else {
        if (window.opener) {
          window.opener.postMessage('authorizing:github', document.location.origin);
        }
      }
    })();
  </script>
</head>
<body>
</body>
</html>
